# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  # åœ¨æŽ¨é€åˆ° main åˆ†æ”¯æ™‚è§¸ç™¼
  push:
    branches:
      - main

# å…è¨± workflow å¯«å…¥éƒ¨ç½²
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # æ­¥é©Ÿ 1: ä¸‹è¼‰æ‚¨çš„ç¨‹å¼ç¢¼
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v4 # ç‰ˆæœ¬æ›´æ–°ï¼šv3 -> v4

      # æ­¥é©Ÿ 2: ç”¨æ‚¨å„²å­˜çš„ Secret æ›¿æ› URL ä½”ä½ç¬¦
      - name: Replace URL Placeholder ðŸ”„
        run: |
          sed -i "s|APPS_SCRIPT_URL_PLACEHOLDER|${{ secrets.APPS_SCRIPT_URL }}|g" index.html
      
      # æ­¥é©Ÿ 3: è¨­å®š GitHub Pages
      - name: Setup Pages âš™ï¸
        uses: actions/configure-pages@v5 # ç‰ˆæœ¬æ›´æ–°ï¼šv3 -> v5

      # æ­¥é©Ÿ 4: ä¸Šå‚³éƒ¨ç½²ç”¢ç‰© (Artifact)
      - name: Upload artifact ðŸ“¦
        uses: actions/upload-pages-artifact@v3 # é—œéµæ›´æ–°ï¼šv2 -> v3
        with:
          # å¾žæ ¹ç›®éŒ„ä¸Šå‚³
          path: '.'

      # æ­¥é©Ÿ 5: éƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages ðŸš€
        id: deployment
        uses: actions/deploy-pages@v4 # ç‰ˆæœ¬æ›´æ–°ï¼šv2 -> v4
