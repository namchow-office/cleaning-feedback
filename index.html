<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>清潔意見回饋 (Cleaning Feedback)</title>
    
    <!-- *** 全新：加入網站圖示 (Favicon) *** -->
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    
    <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        /* CSS 部分完全沒有變更 */
        :root { --bg-gradient: radial-gradient(circle at 10% 20%, rgb(226, 240, 254) 0%, rgb(213, 224, 255) 90%); --card-bg: rgba(255, 255, 255, 0.45); --card-border: rgba(255, 255, 255, 0.3); --text-color: #2c2c2e; --text-muted-color: #555; --highlight-color: #0071e3; } body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg-gradient); min-height: 100vh; color: var(--text-color); } .safe-area-padding { padding: 1rem; padding-top: max(1rem, env(safe-area-inset-top)); padding-bottom: max(1rem, env(safe-area-inset-bottom)); } .glass-card { background: var(--card-bg); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border-radius: 24px; border: 1px solid var(--card-border); box-shadow: 0 16px 40px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; position: relative; overflow: hidden; } .glass-card::before { content: ''; position: absolute; top: var(--mouse-y, -100px); left: var(--mouse-x, -100px); width: 150px; height: 150px; background: radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, rgba(255, 255, 255, 0) 70%); transform: translate(-50%, -50%); opacity: 0; transition: opacity 0.3s ease-out; pointer-events: none; } .glass-card:hover::before { opacity: 1; } .card-grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 1rem; } .selectable-card { cursor: pointer; border-radius: 18px; border: 2px solid rgba(0, 0, 0, 0.05); background-color: rgba(255,255,255,0.4); transition: all 0.3s ease; text-align: center; padding: 1rem; height: 100%; display: flex; flex-direction: column; justify-content: center; } .selectable-card:hover { transform: translateY(-5px); box-shadow: 0 4px 15px rgba(0,0,0,0.05); } .rating-card .material-symbols-outlined { font-size: 2.5rem; color: var(--text-muted-color); transition: color 0.3s ease; } .rating-card .text-primary { font-weight: 500; margin-top: 0.5rem; margin-bottom: 0.1rem; color: var(--text-color); transition: color 0.3s ease;} .rating-card .text-secondary { font-size: 0.8rem; color: var(--text-muted-color); transition: color 0.3s ease;} .rating-card.selected { border-color: var(--highlight-color); background-color: rgba(0, 113, 227, 0.05); } .rating-card.selected .material-symbols-outlined, .rating-card.selected .text-primary, .rating-card.selected .text-secondary { color: var(--highlight-color); } .unsat-item-card .material-symbols-outlined { font-size: 2.5rem; color: #dc3545; } .unsat-item-card h6 { margin-top: 0.5rem; margin-bottom: 0.1rem; font-weight: 500; } .unsat-item-card.selected { border-color: #dc3545; background-color: rgba(220, 53, 69, 0.05); } .form-control { background-color: rgba(255,255,255,0.3); border: 1px solid rgba(0,0,0,0.1); } .submit-btn { background: var(--highlight-color); border: none; color: white; font-weight: 500; font-size: 1.2rem; padding: 0.8rem; border-radius: 16px; transition: all 0.3s ease; } .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0, 113, 227, 0.4); } .submit-btn:disabled { background: #adb5bd; cursor: not-allowed; } @media (prefers-color-scheme: dark) { :root { --bg-gradient: #1d263a; --card-bg: rgba(40, 40, 40, 0.5); --card-border: rgba(255, 255, 255, 0.15); --text-color: #f5f5f7; --text-muted-color: #a1a1a6; } .selectable-card { background-color: rgba(0,0,0,0.2); border-color: rgba(255, 255, 255, 0.1); } .form-control { background-color: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: white;} }
    </style>
</head>
<body>
    <!-- HTML 結構完全沒有變更 -->
    <div class="container safe-area-padding py-4">
        <div class="glass-card mb-4"><div class="card-body text-center py-3"><h5 class="card-title fw-bold mb-0" id="officeNameDisplay">讀取中...</h5><h6 class="card-subtitle" id="deptNameDisplay" style="color: var(--text-muted-color);"></h6></div></div>
        <div class="glass-card mb-4"><div class="card-body text-center py-4"><h4 class="card-title fw-bold mb-1">清潔意見回饋</h4><h6 class="card-subtitle" style="color: var(--text-muted-color);">Cleaning Service Feedback</h6></div></div>
        <div class="glass-card mb-4"><div class="card-body p-4"><label class="col-form-label fw-bold" style="font-size: 1.1rem;">請為我們服務評分<small class="d-block fw-normal" style="color: var(--text-muted-color);">How do you like our service?</small></label><div class="card-grid-container mt-2"><label class="selectable-card rating-card"><input type="radio" name="btnradio" value="5" class="d-none"><span class="material-symbols-outlined">sentiment_very_satisfied</span><div class="text-primary">非常滿意</div><div class="text-secondary">Excellent</div></label><label class="selectable-card rating-card"><input type="radio" name="btnradio" value="4" class="d-none"><span class="material-symbols-outlined">sentiment_satisfied</span><div class="text-primary">滿意</div><div class="text-secondary">Good</div></label><label class="selectable-card rating-card"><input type="radio" name="btnradio" value="3" class="d-none"><span class="material-symbols-outlined">sentiment_neutral</span><div class="text-primary">普通</div><div class="text-secondary">Average</div></label><label class="selectable-card rating-card"><input type="radio" name="btnradio" value="2" class="d-none"><span class="material-symbols-outlined">sentiment_dissatisfied</span><div class="text-primary">不滿意</div><div class="text-secondary">Poor</div></label><label class="selectable-card rating-card"><input type="radio" name="btnradio" value="1" class="d-none"><span class="material-symbols-outlined">sentiment_very_dissatisfied</span><div class="text-primary">很不滿意</div><div class="text-secondary">Very Poor</div></label></div></div></div>
        <div class="glass-card mb-4"><div class="card-body p-4"><label class="col-form-label fw-bold" style="font-size:1.1rem;">是否有您覺得不滿意的項目<small class="d-block fw-normal" style="color: var(--text-muted-color);">Please select unsatisfied items</small></label><div class="card-grid-container mt-2"><label class="selectable-card unsat-item-card"><input type="checkbox" name="unsatisfiedItems" value="辦公區域髒亂" class="d-none"><span class="material-symbols-outlined">workspaces</span><h6>辦公區域髒亂</h6><div class="small" style="color: var(--text-muted-color);">Office Area</div></label><label class="selectable-card unsat-item-card"><input type="checkbox" name="unsatisfiedItems" value="會議室髒亂" class="d-none"><span class="material-symbols-outlined">meeting_room</span><h6>會議室髒亂</h6><div class="small" style="color: var(--text-muted-color);">Meeting Room</div></label><label class="selectable-card unsat-item-card"><input type="checkbox" name="unsatisfiedItems" value="茶水間髒亂" class="d-none"><span class="material-symbols-outlined">local_cafe</span><h6>茶水間髒亂</h6><div class="small" style="color: var(--text-muted-color);">Pantry</div></label><label class="selectable-card unsat-item-card"><input type="checkbox" name="unsatisfiedItems" value="梯廳樓梯髒亂" class="d-none"><span class="material-symbols-outlined">stairs</span><h6>梯廳樓梯髒亂</h6><div class="small" style="color: var(--text-muted-color);">Lobby & Stairs</div></label><label class="selectable-card unsat-item-card"><input type="checkbox" name="unsatisfiedItems" value="廁所環境髒亂" class="d-none"><span class="material-symbols-outlined">wc</span><h6>廁所環境髒亂</h6><div class="small" style="color: var(--text-muted-color);">Restroom</div></label></div><div class="form-group mt-4"><label for="otherMessage" class="fw-bold" style="font-size:1.1rem;">其他意見 (選填)<small class="d-block fw-normal" style="color: var(--text-muted-color);">Other (Optional)</small></label><textarea id="otherMessage" class="form-control mt-2" rows="3" placeholder="請在此輸入您的寶貴意見... (Your feedback here...)"></textarea></div></div></div>
        <div class="glass-card"><div class="card-body p-3"><button class="btn submit-btn w-100" id="submitBtn" type="button">送出意見<br><small>Submit</small></button></div></div>
    </div>
    <div class="modal fade" id="alertModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content glass-card"><div class="modal-header border-0"><h5 class="modal-title fw-bold">提示 (Notice)</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body" id="alertModalBody"></div><div class="modal-footer border-0"><button type="button" class="btn submit-btn w-100" data-bs-dismiss="modal">確定 (OK)</button></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        const SCRIPT_URL = 'APPS_SCRIPT_URL_PLACEHOLDER';
        let deptId, officeId, officeName;
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            deptId = urlParams.get('deptId') || '未知部門';
            officeId = urlParams.get('officeId') || '未知編號';
            officeName = urlParams.get('officeName') || '未知地點';
            document.getElementById('officeNameDisplay').textContent = officeName;
            document.getElementById('deptNameDisplay').textContent = deptId;
        });

        document.querySelectorAll('.glass-card').forEach(card => { card.addEventListener('mousemove', e => { const rect = card.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top; card.style.setProperty('--mouse-x', `${x}px`); card.style.setProperty('--mouse-y', `${y}px`); }); });
        
        $('.rating-card').on('click', function () { $('.rating-card').removeClass('selected'); $(this).addClass('selected').find('input[type="radio"]').prop('checked', true); });
        
        $('.unsat-item-card input[type="checkbox"]').on('change', function() { $(this).closest('.selectable-card').toggleClass('selected', $(this).is(':checked')); });

        // *** 關鍵修復：Fetch 請求改為 'x-www-form-urlencoded' 模式 ***
        $('#submitBtn').on('click', function () {
            const submitButton = $(this);
            const rating = $('input[name="btnradio"]:checked').val();
            if (!rating) {
                $('#alertModalBody').html('請先為我們的服務評分，謝謝！<br>Please select a rating before submitting.');
                new bootstrap.Modal(document.getElementById('alertModal')).show();
                return;
            }
            submitButton.prop('disabled', true).text('傳送中... (Submitting...)');
            
            const unsatisfiedItems = {};
            $('input[name="unsatisfiedItems"]:checked').each(function () {
                unsatisfiedItems[this.value] = '是';
            });

            const dataToSend = {
                deptId: deptId, officeId: officeId, officeName: officeName, rating: rating,
                item1: unsatisfiedItems['辦公區域髒亂'] || '否',
                item2: unsatisfiedItems['會議室髒亂'] || '否',
                item3: unsatisfiedItems['茶水間髒亂'] || '否',
                item4: unsatisfiedItems['梯廳樓梯髒亂'] || '否',
                item5: unsatisfiedItems['廁所環境髒亂'] || '否',
                otherMessage: $('#otherMessage').val() || ''
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(dataToSend) // 使用 URLSearchParams 進行編碼
            })
            .then(response => response.json()) // 假設後端總是返回 JSON
            .then(data => {
                $('#alertModalBody').html('感謝您的回饋，您的意見是我們進步的動力！<br>Thank you for your feedback!');
                const successModal = new bootstrap.Modal(document.getElementById('alertModal'));
                successModal.show();
                document.getElementById('alertModal').addEventListener('hidden.bs.modal', function () {
                    document.body.innerHTML = '<div style="text-align:center; padding-top: 50px; color: var(--text-color);"><h1>提交成功 (Success)</h1><p>您可以關閉此分頁了 (You may now close this page)</p></div>';
                }, { once: true });
            })
            .catch(error => {
                console.error('Fetch Error:', error);
                $('#alertModalBody').html('傳送失敗，請稍後再試。<br>Submission failed. Please try again later.');
                new bootstrap.Modal(document.getElementById('alertModal')).show();
                submitButton.prop('disabled', false).text('送出意見');
            });
        });
    </script>
</body>
</html>
